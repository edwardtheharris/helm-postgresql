# tests/serviceaccount_test_suite.yaml
suite: "PostgreSQL ServiceAccount Test Suite"
release:
  name: postgresql
templates:
  - "templates/serviceaccount.yaml"
values:
  - ../values.yaml

tests:
  - it: "should render ServiceAccount with correct metadata"
    asserts:
      - isKind:
          of: ServiceAccount
      - matchRegex:
          path: metadata.name
          pattern: "^postgres$"
      - equal:
          path: metadata.labels
          value:
            app.kubernetes.io/managed-by: Helm
            app.kubernetes.io/version: 1.16.0
            helm.sh/chart: postgresql-0.0.3
            statefulset.kubernetes.io/instance: postgresql
            statefulset.kubernetes.io/name: postgresql
      - equal:
          path: metadata.annotations
          value:
            serviceaccount.kubernetes.io/name: postgres

  - it: "should render ServiceAccount with correct spec configurations"
    asserts:
      - equal:
          path: automountServiceAccountToken
          value: true
