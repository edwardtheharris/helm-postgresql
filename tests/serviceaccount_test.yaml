# tests/serviceaccount_test_suite.yaml
suite: "PostgreSQL ServiceAccount Test Suite"
templates:
  - "templates/serviceaccount.yaml"

tests:
  - it: "should render ServiceAccount with correct metadata"
    asserts:
      - isKind:
          of: ServiceAccount
      - matchRegex:
          path: metadata.name
          pattern: "^postgres$"
      - equal:
          path: metadata.labels."helm.sh/chart"
          value: "postgresql-0.0.2"
      - equal:
          path: metadata.labels."statefulset.kubernetes.io/name"
          value: "postgresql"
      - equal:
          path: metadata.labels."statefulset.kubernetes.io/instance"
          value: "postgresql"
      - equal:
          path: metadata.labels."app.kubernetes.io/version"
          value: "1.16.0"
      - equal:
          path: metadata.labels."app.kubernetes.io/managed-by"
          value: "Helm"
      - equal:
          path: metadata.annotations."serviceaccount.kubernetes.io/name"
          value: "postgres"

  - it: "should render ServiceAccount with correct spec configurations"
    asserts:
      - equal:
          path: automountServiceAccountToken
          value: true
